<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="login.css">
</head>
<body>

    <div class="login-container">
        <div class="login-box">
            <h2>Bienvenido de nuevo</h2>
            
            <form id="login-form">
                <div class="input-group">
                    <label for="correo">Correo Electrónico</label>
                    <input type="email" id="correo" required placeholder="ejemplo@correo.com">
                </div>

                <div class="input-group">
                    <label for="password">Contraseña</label>
                    <input type="password" id="password" required placeholder="********">
                </div>

                <button type="submit" class="login-button">Ingresar</button>
            </form>

            <div style="margin-top: 20px;">
                <p style="font-size: 14px; color: #666;">
                    ¿No tienes cuenta? <a href="registro.html" style="color: #0b69ff; text-decoration: none; font-weight: bold;">Regístrate aquí</a>
                </p>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const datos = {
                correo: document.getElementById('correo').value,
                password: document.getElementById('password').value
            };

            try {
                const respuesta = await fetch("https://servicios-api-4zmt.onrender.com/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(datos)
                });

                const resultado = await respuesta.json();

                if (respuesta.ok) {
                    // Depuración: Ver en consola qué rol detectó
                    console.log("Login exitoso. Es Admin?:", resultado.usuario.es_admin);

                    localStorage.setItem("usuario_nombre", resultado.usuario.nombre);
                    localStorage.setItem("usuario_id", resultado.usuario.id);
                    // Guardamos roles para usarlos en principal.html
                    localStorage.setItem("es_trabajador", resultado.usuario.es_trabajador);
                    localStorage.setItem("es_admin", resultado.usuario.es_admin); 
                    
                    alert("¡Bienvenido " + resultado.usuario.nombre + "!");
                    
                    // --- REDIRECCIÓN CORREGIDA ---
                    if (resultado.usuario.es_admin === true) {
                        // Si es Admin -> Panel Admin
                        window.location.href = "admin.html"; 
                    } else {
                        // Si es Cliente/Trabajador -> Dashboard Principal
                        window.location.href = "index.html"; 
                    }
                    
                } else {
                    alert("Error: El correo o la contraseña son incorrectas.");
                }

            } catch (error) {
                console.error(error);
                alert("No se pudo conectar con el servidor.");
            }
        });
    </script>

</body>
</html>
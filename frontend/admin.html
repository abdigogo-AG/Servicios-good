<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Administraci√≥n</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 2px solid #0b69ff; padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; color: #555; }
        
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .badge-trabajador { background: #e3f2fd; color: #0d47a1; }
        .badge-cliente { background: #e8f5e9; color: #1b5e20; }
        .badge-admin { background: #f3e5f5; color: #4a148c; }
        
        .btn { padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px; }
        .btn-validar { background: #28a745; color: white; }
        .btn-bloquear { background: #ffc107; color: black; }
        .btn-borrar { background: #dc3545; color: white; }
        .btn-desbloquear { background: #17a2b8; color: white; }
        
        .bloqueado-row { background-color: #fff3cd; }
    </style>
</head>
<body>

    <div class="container">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h1>Panel de Control - Admin</h1>
            <button onclick="window.location.href='login.html'" class="btn" style="background:#333; color:white;">Cerrar Sesi√≥n</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Correo</th>
                    <th>Rol</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tabla-usuarios">
                <tr><td colspan="5">Cargando usuarios...</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        async function cargarUsuarios() {
            try {
                const res = await fetch("https://servicios-api-4zmt.onrender.com/admin/usuarios");
                const usuarios = await res.json();
                
                const tbody = document.getElementById('tabla-usuarios');
                tbody.innerHTML = "";

                usuarios.forEach(u => {
                    const esBloqueado = u.bloqueado_hasta != null;
                    const claseFila = esBloqueado ? 'bloqueado-row' : '';
                    
                    // Determinar estado texto
                    let estadoHTML = "";
                    if (esBloqueado) estadoHTML = `<span style="color:red"> Bloqueado</span>`;
                    else if (u.rol === 'Trabajador' && !u.validado_por_admin) estadoHTML = `<span style="color:orange">‚è≥ Pendiente</span>`;
                    else estadoHTML = `<span style="color:green"> Activo</span>`;

                    // Botones din√°micos
                    let botones = "";
                    
                    // Bot√≥n Validar (Solo Trabajadores Pendientes)
                    if (u.rol === 'Trabajador' && !u.validado_por_admin) {
                        botones += `<button class="btn btn-validar" onclick="accion('${u.id}', 'validar')"><i class="fas fa-check"></i> Aceptar</button>`;
                    }

                    // Bot√≥n Bloquear/Desbloquear (No te puedes bloquear a ti mismo si eres Admin)
                    if (u.rol !== 'Admin') {
                        if (esBloqueado) {
                            botones += `<button class="btn btn-desbloquear" onclick="accion('${u.id}', 'desbloquear')">üîì Desbloq</button>`;
                        } else {
                            botones += `<button class="btn btn-bloquear" onclick="bloquear('${u.id}')">‚õî Bloquear</button>`;
                        }
                        botones += `<button class="btn btn-borrar" onclick="accion('${u.id}', 'borrar')"><i class="fas fa-trash"></i></button>`;
                    }

                    const row = `
                        <tr class="${claseFila}">
                            <td>${u.nombre} ${u.apellidos}</td>
                            <td>${u.correo_electronico}</td>
                            <td><span class="badge badge-${u.rol.toLowerCase()}">${u.rol}</span></td>
                            <td>${estadoHTML}</td>
                            <td>${botones}</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });

            } catch (e) {
                alert("Error cargando usuarios. ¬øEres admin?");
                console.error(e);
            }
        }

        async function accion(id, tipo, dias=0) {
            if (tipo === 'borrar' && !confirm("¬øSeguro que quieres borrar a este usuario?")) return;

            try {
                const res = await fetch("https://servicios-api-4zmt.onrender.com/admin/accion", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ usuario_id: id, accion: tipo, dias_bloqueo: dias })
                });
                const data = await res.json();
                if(res.ok) {
                    alert(data.mensaje);
                    cargarUsuarios(); // Recargar tabla
                } else {
                    alert("Error: " + data.detail);
                }
            } catch (e) { console.error(e); }
        }

        function bloquear(id) {
            const dias = prompt("¬øPor cu√°ntos d√≠as quieres bloquearlo?", "7");
            if (dias) {
                accion(id, 'bloquear', parseInt(dias));
            }
        }

        // Iniciar
        cargarUsuarios();
    </script>
</body>
</html>


  <!-- Ingresa como Admin:
    * **Correo: admin@sistema.com
    * **Password: admin123 -->
